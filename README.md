
# ğŸŒ å°ç£å°å€åŸŸåœ°éœ‡è§€æ¸¬ç¶² (Taiwan Earthquake Observation System)

é€™æ˜¯ä¸€å€‹åŸºæ–¼ **PHP** èˆ‡ **MySQL** é–‹ç™¼çš„å³æ™‚åœ°éœ‡è³‡è¨Šè¦–è¦ºåŒ–å¹³å°ã€‚é€éä¸²æ¥ä¸­å¤®æ°£è±¡ç½² (CWA) çš„ Open Data APIï¼Œç³»çµ±èƒ½è‡ªå‹•åŒæ­¥æœ€æ–°çš„åœ°éœ‡æ•¸æ“šï¼Œä¸¦çµåˆ **Leaflet.js** åœ°åœ–æŠ€è¡“èˆ‡ç¤¾ç¾¤äº’å‹•æ©Ÿåˆ¶ï¼Œæä¾›ä½¿ç”¨è€…ç›´è§€ä¸”å…·å‚™åœ°è³ªåˆ†æèƒ½åŠ›çš„è§€æ¸¬ä»‹é¢ã€‚

## âœ¨ æ ¸å¿ƒåŠŸèƒ½ (Features)

### 1. ğŸ—ºï¸ GIS åœ°ç†è³‡è¨Šè¦–è¦ºåŒ–

* **äº’å‹•å¼åœ°åœ–**ï¼šä½¿ç”¨ Leaflet.js ç¹ªè£½ï¼Œæ”¯æ´ç¸®æ”¾èˆ‡å¹³ç§»ã€‚
* **å¤šåœ–å±¤åˆ‡æ›**ï¼š
* ğŸ”´ **åœ°éœ‡åœ“é» (Markers)**ï¼šä¾æ“šè¦æ¨¡å¤§å°é¡¯ç¤ºä¸åŒé¡è‰²ï¼ˆè¦æ¨¡ 4.0 ä»¥ä¸Šé¡¯ç¤ºç´…è‰²è­¦æˆ’ï¼‰ã€‚
* â™¨ï¸ **ç†±åŠ›åœ– (Heatmap)**ï¼šè¦–è¦ºåŒ–å‘ˆç¾åœ°éœ‡é »ç™¼å€åŸŸã€‚
* ğŸŒŠ **æ¿å¡Šé‚Šç•Œ**ï¼šç¹ªè£½è²å¾‹è³“æµ·æ¿å¡Šèˆ‡æ­äºå¤§é™¸æ¿å¡Šäº¤ç•Œï¼ˆèŠ±æ±ç¸±è°·ç·šï¼‰ã€‚
* âš ï¸ **æ´»å‹•æ–·å±¤**ï¼šå…§å»ºå°ç£ä¸»è¦æ´»å‹•æ–·å±¤è·¯å¾‘ï¼ˆå¦‚è»Šç± åŸ”ã€ç±³å´™æ–·å±¤ç­‰ï¼‰ã€‚
* **æ²‰æµ¸å¼å®šä½**ï¼šé»æ“Šåˆ—è¡¨å¡ç‰‡ï¼Œåœ°åœ–è‡ªå‹•å¹³æ»‘é£›è¡Œ (FlyTo) è‡³éœ‡å¤®ä¸¦å½ˆå‡ºè©³ç´°è³‡è¨Šã€‚

### 2. ğŸ“Š æ•¸æ“šåˆ†æå„€è¡¨æ¿

* **è¶¨å‹¢åœ–è¡¨**ï¼šæ•´åˆ Chart.js ç¹ªè£½ã€Œè¿‘ 7 æ—¥åœ°éœ‡é »ç‡ã€é•·æ¢åœ–ã€‚
* **è¦æ¨¡åˆ†ä½ˆ**ï¼šç”œç”œåœˆåœ–åˆ†æå°å€åŸŸ (<3)ã€é¡¯è‘— (3-4) èˆ‡å¼·éœ‡ (>4) çš„æ¯”ä¾‹ ã€‚
* **å³æ™‚ç¯©é¸**ï¼šå‰ç«¯å³æ™‚éæ¿¾åŠŸèƒ½ï¼Œå¯ç¯©é¸ã€Œè¦æ¨¡ 3.0 / 4.0 / 5.0 ä»¥ä¸Šã€çš„åœ°éœ‡è³‡è¨Š ã€‚

### 3. ğŸ‘¥ ç¤¾ç¾¤äº’å‹•èˆ‡ç½æƒ…å›å ± (Crowdsourcing)

* **å¯æ€•ç¨‹åº¦è©•åˆ†**ï¼šç™»å…¥æœƒå“¡å¯é‡å°ç‰¹å®šåœ°éœ‡é€²è¡Œ 1~10 åˆ†çš„ä¸»è§€ææ‡¼è©•åˆ† ã€‚
* **å³æ™‚çµ±è¨ˆ**ï¼šç³»çµ±è‡ªå‹•è¨ˆç®—æ¯èµ·åœ°éœ‡çš„ã€Œå¹³å‡ææ‡¼åˆ†æ•¸ã€èˆ‡ã€Œç¸½å›å ±äººæ•¸ã€ï¼Œé‡åŒ–æ°‘çœ¾çœŸå¯¦æ„Ÿå— ã€‚
### 4. ğŸ” æœƒå“¡èˆ‡æ¬Šé™ç®¡ç†

* **è³‡å®‰é˜²è­·**ï¼šå¯†ç¢¼æ¡ç”¨ SHA-256 åŠ å¯†å„²å­˜ï¼Œä¸¦ä½¿ç”¨ PDO é è™•ç†é˜²æ­¢ SQL Injection ã€‚
* **æ¬Šé™åˆ†ç´š (RBAC)** ï¼š
* **ä¸€èˆ¬ä½¿ç”¨è€… (Role 1)**ï¼šç€è¦½è³‡è¨Šã€ç¯©é¸æ•¸æ“šã€æäº¤å›å ±ã€‚
* **ç®¡ç†å“¡ (Role 0)**ï¼šæ“æœ‰åŸ·è¡Œè³‡æ–™åŒæ­¥ API (`eq_sync.php`) çš„æ¬Šé™ã€‚



### 5. ğŸ¨ æ²‰æµ¸å¼ UI è¨­è¨ˆ

* **æ·±è‰²æ¨¡å¼ (Dark Mode)**ï¼šé©åˆé•·æ™‚é–“ç›£æ§çš„æ·±è‰²ä»‹é¢ã€‚
**å‹•æ…‹èƒŒæ™¯**ï¼šå…¨è¢å¹•å½±ç‰‡èƒŒæ™¯ (`light.mp4`)ï¼Œæå‡è¦–è¦ºé«”é©— ã€‚



---

## ğŸ› ï¸ æŠ€è¡“å †ç–Š (Tech Stack)

* **Backend**: PHP (Native, No Framework)
* **Database**: MySQL / MariaDB (InnoDB Engine)
* **Frontend**: HTML5, CSS3, JavaScript (ES6)
* **Libraries**:
* [Leaflet.js](https://leafletjs.com/) (Map)
* [Leaflet.heat](https://github.com/Leaflet/Leaflet.heat) (Heatmap visualization)
* [Chart.js](https://www.chartjs.org/) (Data Visualization)


* **Data Source**: [ä¸­å¤®æ°£è±¡ç½² Open Data API (E-A0016-001)](https://opendata.cwa.gov.tw/) 



---

## ğŸ’¾ è³‡æ–™åº«æ¶æ§‹ (Database Schema)

æœ¬å°ˆæ¡ˆåŒ…å«ä¸‰å¼µä¸»è¦è³‡æ–™è¡¨ï¼šä½¿ç”¨è€…ã€åœ°éœ‡æ•¸æ“šã€ææ‡¼å›å ±ã€‚

```mermaid
erDiagram
    USERS {
        int id PK
        string username
        string password "SHA-256 Hash"
        int role "0:Admin, 1:User"
        datetime created_at
    }
    EARTHQUAKE_DATA {
        int id PK
        datetime origin_time
        decimal magnitude
        decimal depth
        decimal latitude
        decimal longitude
        string location_desc
    }
    FEAR_REPORTS {
        int id PK
        int user_id FK
        int earthquake_id FK
        tinyint score "1-10"
        datetime created_at
    }
    USERS ||--o{ FEAR_REPORTS : submits
    EARTHQUAKE_DATA ||--o{ FEAR_REPORTS : has

```

*[å¼•ç”¨ä¾†æº: 5, 6, 7]*

---

## ğŸš€ å®‰è£èˆ‡åŸ·è¡Œ (Installation)

### 1. ç’°å¢ƒéœ€æ±‚

* PHP 7.4 æˆ–æ›´é«˜ç‰ˆæœ¬ (éœ€é–‹å•Ÿ cURL èˆ‡ PDO æ“´å……)
* MySQL 5.7 æˆ– MariaDB
* Apache / Nginx Web Server

### 2. è³‡æ–™åº«è¨­å®š

è«‹åœ¨ MySQL ä¸­å»ºç«‹è³‡æ–™åº« `earthquake_system` ä¸¦åŒ¯å…¥ä»¥ä¸‹ SQLï¼š

```sql
CREATE DATABASE earthquake_system CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE earthquake_system;

-- åœ°éœ‡è³‡æ–™è¡¨
CREATE TABLE earthquake_data (
    id INT AUTO_INCREMENT PRIMARY KEY,
    origin_time DATETIME NOT NULL,
    longitude FLOAT, latitude FLOAT, depth FLOAT, magnitude FLOAT,
    location_desc TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY unique_eq (origin_time, longitude, latitude)
);

-- ä½¿ç”¨è€…è³‡æ–™è¡¨
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    role TINYINT DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ææ‡¼å›å ±è³‡æ–™è¡¨
CREATE TABLE fear_reports (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    earthquake_id INT NOT NULL,
    score TINYINT NOT NULL CHECK (score BETWEEN 1 AND 10),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY unique_report (user_id, earthquake_id),
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (earthquake_id) REFERENCES earthquake_data(id)
);

```

### 3. å°ˆæ¡ˆè¨­å®š

1. å°‡å°ˆæ¡ˆè¤‡è£½åˆ° Web Server æ ¹ç›®éŒ„ (å¦‚ `htdocs` æˆ– `www`)ã€‚
2. ä¿®æ”¹ `db.php` è¨­å®šè³‡æ–™åº«é€£ç·šï¼š
```php
$host = 'localhost';
$db   = 'earthquake_system';
$user = 'root'; // æ‚¨çš„è³‡æ–™åº«å¸³è™Ÿ
$pass = '';     // æ‚¨çš„è³‡æ–™åº«å¯†ç¢¼

```
3. ä¿®æ”¹ `eq_sync.php` è¨­å®šä½ è‡ªå·±çš„API:
```php
$apiKey = "è‡ªå·±çš„API"; 
$apiUrl = "https://opendata.cwa.gov.tw/api/v1/rest/datastore/E-A0016-001?Authorization={$apiKey}&format=JSON";
```

4. ç¢ºä¿ `video/` è³‡æ–™å¤¾å…§æœ‰èƒŒæ™¯å½±ç‰‡æª” (`light.mp4`) ã€‚



### 4. è³‡æ–™åŒæ­¥

1. è¨»å†Šä¸€å€‹æ–°å¸³è™Ÿï¼Œä¸¦åœ¨è³‡æ–™åº«å°‡å…¶ `role` ä¿®æ”¹ç‚º `0` (ç®¡ç†å“¡) ã€‚


2. ç™»å…¥å¾Œï¼Œé»æ“Šé¦–é ä¸Šæ–¹çš„ **ã€ŒğŸ“¡ åŒæ­¥æœ€æ–°è³‡æ–™ã€** æŒ‰éˆ•ï¼Œç³»çµ±å°‡å¾æ°£è±¡ç½² API æŠ“å–æœ€æ–°åœ°éœ‡è³‡è¨Šã€‚

---



## ğŸ“„ æˆæ¬Š (License)
MIT License
æœ¬å°ˆæ¡ˆç‚ºå­¸è¡“ç ”ç©¶èˆ‡æ•™è‚²ç”¨é€”ã€‚
è³‡æ–™ä¾†æºï¼šä¸­å¤®æ°£è±¡ç½² (CWA) é–‹æ”¾è³‡æ–™å¹³å°ã€‚


